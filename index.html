<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>ARios lc</title>
    <meta name="description" content="A-Frame AR - untitled2.glb">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <script src="aframe-v1.5.0.min.js"></script> <!-- Lokal A-Frame -->

    <style>
        body { margin: 0; overflow: hidden; font-family: Arial, sans-serif; }
        a-scene { height: 100vh; width: 100vw; }

        .ui-controls {
            position: fixed;
            bottom: 20px;
            width: 100%;
            display: flex;
            justify-content: space-around;
            align-items: center;
            z-index: 10;
            padding: 0 10px;
            box-sizing: border-box;
        }
        .ui-controls div { display: flex; gap: 8px; }
        .ui-controls button {
            padding: 12px 15px; font-size: 16px; background-color: rgba(0,0,0,0.7); /* Sal shaffofroq */
            color: white; border: none; border-radius: 8px; cursor: pointer;
            min-width: 50px; text-align: center;
            -webkit-tap-highlight-color: transparent; /* Mobil uchun bosish effektini olib tashlash */
        }
        .ui-controls button:active { background-color: rgba(0,0,0,0.9); }

        #ar-status-message-div {
            position: fixed; top: 15px; left: 50%; transform: translateX(-50%);
            z-index: 100; /* Boshqa elementlardan ustunroq */
            visibility: hidden; background-color: rgba(0,0,0,0.75);
            color: white; padding: 8px 12px; border-radius: 5px; font-size: 14px;
        }
    </style>
</head>
<body>
    <a-scene
        webxr="optionalFeatures: dom-overlay, hit-test;"
        ar-mode-ui="enabled: true; overlayElement: #ar-status-message-div;"
        renderer="colorManagement: true; physicallyCorrectLights: true;"
        background="color: #DADADA" <!-- Fon rangini biroz o'zgartirdim -->
        id="myScene"
        vr-mode-ui="enabled: false"> <!-- Agar VR kerak bo'lmasa, VR tugmasini yashirish -->

        <a-assets timeout="60000">
            <a-asset-item id="buildingAsset" src="untitled2.glb"></a-asset-item>
        </a-assets>

        <!-- Kamera Rig (O'yinchi) -->
        <a-entity id="playerRig" position="0 0.5 4" <!-- Boshlang'ich pozitsiya, modeldan orqaroqda -->
                  
                  <!-- PC uchun WASD nazorati. Mobil uchun bu komponentni dinamik ravishda o'chirish/yoqish mumkin. -->
                  wasd-controls="fly: true; acceleration: 35; enabled: true;" 
                  
                  <!-- Sichqoncha va Sensorli ekran bilan aylanish. -->
                  <!-- Hozircha look-controls ni playerRig ga qo'yamiz, bu butun rig ni aylantiradi. -->
                  <!-- Agar faqat kamera aylanishini xohlasangiz, buni <a-camera> ichiga ko'chiring va JavaScriptni moslang. -->
                  look-controls="pointerLockEnabled: true; 
                                 magicWindowTrackingEnabled: false; 
                                 touchEnabled: true;  <!-- Mobil uchun sensorli aylanish -->
                                 mouseEnabled: true;  <!-- PC uchun sichqoncha bilan aylanish -->
                                 enabled: true;">
            <a-entity id="camera" 
                      camera="active: true; fov: 70;" <!-- Ko'rish burchagini biroz o'zgartirish mumkin -->
                      position="0 1.6 0">
            </a-entity>
        </a-entity>

        <!-- Sizning GLB modelingiz -->
        <a-gltf-model
            src="#buildingAsset"
            id="mainBuilding"
            position="0 0 0" <!-- Modelning markazi 0,0,0 da -->
            scale="0.5 0.5 0.5"
            animation-mixer
            visible="true">
        </a-gltf-model>

        <a-plane id="groundPlane" position="0 -0.01 0" rotation="-90 0 0" width="100" height="100"
                 color="#AAAAAA" visible="true"></a-plane> <!-- Yer rangini o'zgartirdim -->

        <a-sky color="#C5CAE9"></a-sky> <!-- Oddiy osmon foni -->

        <a-light type="ambient" color="#FFF" intensity="0.8"></a-light>
        <a-light type="directional" color="#FFF" intensity="0.7" position="-2 3.5 2.5"></a-light>

    </a-scene>

    <div class="ui-controls">
        <div>
            <button id="btnHeightUp">▲ Balandlik</button>
            <button id="btnHeightDown">▼ Balandlik</button>
        </div>
        <div>
            <button id="btnScaleUp">➕ Masshtab</button>
            <button id="btnScaleDown">➖ Masshtab</button>
        </div>
    </div>

    <div id="ar-status-message-div">
        <span id="ar-status-message">AR rejimiga tayyor.</span>
    </div>

    <script>
        const sceneEl = document.getElementById('myScene');
        const playerRigEl = document.getElementById('playerRig');
        const cameraEl = document.getElementById('camera'); // Kamera endi playerRig ichida
        const buildingModelEl = document.getElementById('mainBuilding');
        
        const btnHeightUpEl = document.getElementById('btnHeightUp');
        const btnHeightDownEl = document.getElementById('btnHeightDown');
        const btnScaleUpEl = document.getElementById('btnScaleUp');
        const btnScaleDownEl = document.getElementById('btnScaleDown');
        const arStatusDivEl = document.getElementById('ar-status-message-div');
        const arStatusMsgEl = document.getElementById('ar-status-message');

        const PLAYER_RIG_Y_STEP = 0.25; // Balandlik o'zgarish qadami
        const MODEL_SCALE_STEP = 0.05;
        const MIN_MODEL_SCALE_VAL = 0.01;
        const MIN_PLAYER_RIG_Y_POS = -15; // Yer ostini ko'rish uchun
        const MAX_PLAYER_RIG_Y_POS = 20;  // Maksimal balandlik

        function isMobileDevice() {
            return /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent);
        }

        // Nazoratni yoqish/o'chirish (PC va Mobil uchun moslashtirilgan)
        function toggleControls(enable) {
            if (playerRigEl.components['wasd-controls']) {
                // WASD ni faqat PC da yoqamiz/o'chiramiz
                playerRigEl.setAttribute('wasd-controls', 'enabled', !isMobileDevice() && enable);
            }
            if (playerRigEl.components['look-controls']) {
                playerRigEl.setAttribute('look-controls', 'enabled', enable);
                if (enable) {
                    // Agar pointerLockEnabled bo'lsa, uni faqat PC da yoqamiz
                    playerRigEl.setAttribute('look-controls', 'pointerLockEnabled', !isMobileDevice());
                    playerRigEl.components['look-controls'].play();
                } else {
                    playerRigEl.components['look-controls'].pause();
                }
            }
            console.log(`Virtual controls ${enable ? 'enabled' : 'disabled'}. Mobile: ${isMobileDevice()}`);
        }

        sceneEl.addEventListener('loaded', function () {
            console.log('A-Frame sahna yuklandi.');
            if (arStatusMsgEl) arStatusMsgEl.textContent = "Sahna yuklandi. ARga tayyor.";

            buildingModelEl.addEventListener('model-loaded', function () {
                console.log('GLB model yuklandi.');
                if (arStatusMsgEl && !sceneEl.is('ar-mode')) {
                    arStatusMsgEl.textContent = "Model yuklandi. ARga tayyor.";
                }
            });
            buildingModelEl.addEventListener('model-error', function (e) {
                console.error('GLB model yuklashda xatolik:', e.detail.src);
                if (arStatusDivEl) arStatusDivEl.style.visibility = 'visible';
                if (arStatusMsgEl) arStatusMsgEl.textContent = "XATOLIK: Model fayli yuklanmadi!";
            });

            // Dastlabki nazorat holati
            toggleControls(!sceneEl.is('ar-mode'));

            // AR rejimi hodisalari
            sceneEl.addEventListener('enter-vr', function () {
                if (sceneEl.is('ar-mode')) {
                    console.log("AR rejimiga kirildi!");
                    if (arStatusDivEl) arStatusDivEl.style.visibility = 'visible';
                    if (arStatusMsgEl) arStatusMsgEl.textContent = "AR Rejimida.";
                    toggleControls(false); // ARda virtual nazoratni o'chiramiz
                    // ARda UI tugmalarini yashirish (ixtiyoriy)
                    // document.querySelector('.ui-controls').style.display = 'none'; 
                }
            });

            sceneEl.addEventListener('exit-vr', function () {
                console.log("AR rejimidan chiqildi!");
                if (arStatusDivEl) arStatusDivEl.style.visibility = 'hidden';
                toggleControls(true); // 3D rejim uchun nazoratni qayta yoqamiz
                // document.querySelector('.ui-controls').style.display = 'flex';
            });

            // Balandlikni sozlash (Player Rig ning Y pozitsiyasini o'zgartiradi)
            btnHeightUpEl.addEventListener('click', () => {
                const currentPos = playerRigEl.getAttribute('position');
                let newY = currentPos.y + PLAYER_RIG_Y_STEP;
                if (newY > MAX_PLAYER_RIG_Y_POS) newY = MAX_PLAYER_RIG_Y_POS;
                playerRigEl.setAttribute('position', { x: currentPos.x, y: newY, z: currentPos.z });
            });
            btnHeightDownEl.addEventListener('click', () => {
                const currentPos = playerRigEl.getAttribute('position');
                let newY = currentPos.y - PLAYER_RIG_Y_STEP;
                if (newY < MIN_PLAYER_RIG_Y_POS) newY = MIN_PLAYER_RIG_Y_POS;
                playerRigEl.setAttribute('position', { x: currentPos.x, y: newY, z: currentPos.z });
            });

            // Model masshtabini sozlash
            btnScaleUpEl.addEventListener('click', () => {
                const currentScale = buildingModelEl.getAttribute('scale');
                buildingModelEl.setAttribute('scale', { 
                    x: currentScale.x + MODEL_SCALE_STEP, 
                    y: currentScale.y + MODEL_SCALE_STEP, 
                    z: currentScale.z + MODEL_SCALE_STEP 
                });
            });
            btnScaleDownEl.addEventListener('click', () => {
                const currentScale = buildingModelEl.getAttribute('scale');
                let newS = currentScale.x - MODEL_SCALE_STEP;
                if (newS < MIN_MODEL_SCALE_VAL) newS = MIN_MODEL_SCALE_VAL;
                buildingModelEl.setAttribute('scale', { x: newS, y: newS, z: newS });
            });
        });
    </script>
</body>
</html>
